<p-toast></p-toast>

<div class="toolbar">
  <h2>Histórico de Vendas</h2>
  <button pButton label="Registrar Nova Venda" class="p-button-success" (click)="novaVenda()"></button>
</div>

<p-table [value]="vendas" [paginator]="true" [rows]="10" [loading]="carregando" dataKey="id">
  <ng-template pTemplate="header">
    <tr>
      <th style="width: 5rem"></th>
      <th pSortableColumn="dataHora">Data/Hora <p-sortIcon field="dataHora"></p-sortIcon></th>
      <th pSortableColumn="usuarioNome">Usuário <p-sortIcon field="usuarioNome"></p-sortIcon></th>
      <th pSortableColumn="valorTotal">Valor Total <p-sortIcon field="valorTotal"></p-sortIcon></th>
      <th pSortableColumn="valorRecebido">V. Recebido <p-sortIcon field="valorRecebido"></p-sortIcon></th>
      <th pSortableColumn="troco">Troco <p-sortIcon field="troco"></p-sortIcon></th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-v let-expanded="expanded">
    <tr>
      <td>
        <button type="button" pButton pRipple [pRowToggler]="v" class="p-button-text p-button-rounded p-button-plain" [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></button>
      </td>
      <td>{{ v.dataHora | date:'dd/MM/yyyy HH:mm' }}</td>
      <td>{{ v.usuarioNome }}</td>
      <td>{{ v.valorTotal | currency:'BRL' }}</td>
      <td>{{ v.valorRecebido | currency:'BRL' }}</td>
      <td>{{ v.troco | currency:'BRL' }}</td>
    </tr>
  </ng-template>
  
  <ng-template pTemplate="rowexpansion" let-v>
    <tr>
      <td colspan="6">
        <div class="p-3">
          <h5>Itens da Venda #{{v.id}}</h5>
          <p-table [value]="v.itens">
            <ng-template pTemplate="header">
              <tr>
                <th>Produto</th>
                <th>Qtd.</th>
                <th>Preço Unit.</th>
                <th>Subtotal</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-item>
              <tr>
                <td>{{ item.produtoNome }}</td>
                <td>{{ item.quantidade }}</td>
                <td>{{ item.precoUnitario | currency:'BRL' }}</td>
                <td>{{ item.subtotal | currency:'BRL' }}</td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </td>
    </tr>
  </ng-template>

  <ng-template pTemplate="emptymessage">
    <tr>
      <td colspan="6">Nenhuma venda encontrada.</td>
    </tr>
  </ng-template>
</p-table>

<div class="summary">
  Total: {{ vendas.length }}
</div>